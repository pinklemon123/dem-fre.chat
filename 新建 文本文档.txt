å¥½çš„ ğŸ‘ æˆ‘ç»™ä½ æ•´ç†ä¸€ä»½ å®Œæ•´æ–‡æ¡£ï¼Œä½ å¯ä»¥ç›´æ¥æ”¾è¿› VSCode é¡¹ç›®é‡Œï¼Œä½œä¸º README æˆ–è€…éƒ¨ç½²æŒ‡å—ã€‚è¿™æ ·ä½ åœ¨ç”¨ AI è¾…åŠ©å¼€å‘æ—¶ï¼Œå®ƒä¹Ÿèƒ½ä¸€çœ¼ç†è§£æ•´ä¸ªç¯å¢ƒä¸æµç¨‹ã€‚

ğŸš€ Google Cloud + Docker + Cloud Run éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—æ¼”ç¤ºå¦‚ä½•æŠŠä¸€ä¸ª Node.js/Express åç«¯æ‰“åŒ…æˆ Docker é•œåƒï¼Œå¹¶éƒ¨ç½²åˆ° Google Cloud Runï¼Œé…åˆ Cloud SQL æ•°æ®åº“å’Œ Firebase Hosting å‰ç«¯ã€‚

ç›®å½•

å‰ç½®æ¡ä»¶

é¡¹ç›®ç»“æ„

Docker æ‰“åŒ…

æœ¬åœ°è¿è¡Œä¸æµ‹è¯•

æ¨é€åˆ° Google Artifact Registry

éƒ¨ç½²åˆ° Cloud Run

ï¼ˆå¯é€‰ï¼‰è¿æ¥ Cloud SQL

ï¼ˆå¯é€‰ï¼‰å‰ç«¯é™æ€ç«™ç‚¹ + API åä»£

ä¸‹ä¸€æ­¥

1. å‰ç½®æ¡ä»¶

å·²å®‰è£…å¹¶ç™»å½•ï¼š

Docker Desktop
ï¼ˆWSL2 ä¸‹é›†æˆï¼‰

Google Cloud SDK

Firebase CLI
ï¼ˆç”¨äºæ‰˜ç®¡å‰ç«¯ï¼‰

éªŒè¯å‘½ä»¤æ˜¯å¦å¯ç”¨ï¼š

docker --version
gcloud --version
firebase --version


ç™»å½• Google Cloudï¼š

gcloud auth login
gcloud config set project PROJECT_ID

2. é¡¹ç›®ç»“æ„

ç¤ºä¾‹ Node.js Express é¡¹ç›®ï¼š

myapp/
 â”œâ”€ Dockerfile
 â”œâ”€ package.json
 â”œâ”€ index.js
 â””â”€ prisma/
     â””â”€ schema.prisma


index.js

import express from "express";
import { PrismaClient } from "@prisma/client";

const app = express();
app.use(express.json());

const prisma = new PrismaClient();

app.get("/health", (_req, res) => res.send({ ok: true }));

app.get("/notes", async (_req, res) => {
  const notes = await prisma.note.findMany({ orderBy: { id: "desc" } });
  res.send(notes);
});

app.post("/notes", async (req, res) => {
  const note = await prisma.note.create({ data: { content: req.body.content ?? "" } });
  res.status(201).send(note);
});

const port = process.env.PORT || 8080;
app.listen(port, () => console.log(`API running on port ${port}`));

3. Docker æ‰“åŒ…

Dockerfile

FROM node:20-alpine

WORKDIR /app
COPY package*.json ./
RUN npm install --only=production
COPY . .

EXPOSE 8080
CMD ["npm", "start"]

4. æœ¬åœ°è¿è¡Œä¸æµ‹è¯•
# æ„å»ºé•œåƒ
docker build -t myapp:1.0 .

# è¿è¡Œå®¹å™¨
docker run -p 8080:8080 myapp:1.0


æµè§ˆå™¨è®¿é—® http://localhost:8080/health
 ï¼Œåº”è¿”å› { ok: true }ã€‚

5. æ¨é€åˆ° Google Artifact Registry

å¯ç”¨æœåŠ¡ï¼š

gcloud services enable artifactregistry.googleapis.com


åˆ›å»ºä»“åº“ï¼š

gcloud artifacts repositories create my-repo \
  --repository-format=docker \
  --location=asia-east1 \
  --description="Docker repo for my app"


é…ç½® Docker ç™»å½•ï¼š

gcloud auth configure-docker asia-east1-docker.pkg.dev


æ‰“æ ‡ç­¾å¹¶æ¨é€ï¼š

docker tag myapp:1.0 asia-east1-docker.pkg.dev/PROJECT_ID/my-repo/myapp:1.0
docker push asia-east1-docker.pkg.dev/PROJECT_ID/my-repo/myapp:1.0

6. éƒ¨ç½²åˆ° Cloud Run
gcloud run deploy myapp \
  --image asia-east1-docker.pkg.dev/PROJECT_ID/my-repo/myapp:1.0 \
  --region asia-east1 \
  --platform managed \
  --allow-unauthenticated


éƒ¨ç½²æˆåŠŸåï¼Œä¼šè¿”å›ä¸€ä¸ªå…¬å…± URLï¼Œä¾‹å¦‚ï¼š
https://myapp-xxxxx-asia-east1.run.app

7. ï¼ˆå¯é€‰ï¼‰è¿æ¥ Cloud SQL

åˆ›å»ºæ•°æ®åº“å®ä¾‹ï¼ˆPostgreSQLï¼‰ï¼š

gcloud sql instances create app-postgres \
  --database-version=POSTGRES_15 \
  --tier=db-custom-1-3840 \
  --region=asia-east1
gcloud sql databases create appdb --instance=app-postgres
gcloud sql users create appuser --instance=app-postgres --password="YourPass123!"


éƒ¨ç½²æ—¶æ·»åŠ å‚æ•°ï¼š

gcloud run deploy myapp \
  --image asia-east1-docker.pkg.dev/PROJECT_ID/my-repo/myapp:1.0 \
  --region asia-east1 \
  --platform managed \
  --allow-unauthenticated \
  --add-cloudsql-instances PROJECT_ID:asia-east1:app-postgres \
  --set-env-vars DATABASE_URL="postgresql://appuser:YourPass123!@localhost:5432/appdb"

8. ï¼ˆå¯é€‰ï¼‰å‰ç«¯é™æ€ç«™ç‚¹ + API åä»£

åˆå§‹åŒ– Firebase Hostingï¼š

firebase init hosting


ä¿®æ”¹ firebase.jsonï¼Œå°† /api/** è¯·æ±‚è½¬å‘åˆ° Cloud Runï¼š

{
  "hosting": {
    "public": "dist",
    "rewrites": [
      {
        "source": "/api/**",
        "run": {
          "serviceId": "myapp",
          "region": "asia-east1"
        }
      }
    ]
  }
}


éƒ¨ç½²å‰ç«¯ï¼š

firebase deploy --only hosting

9. ä¸‹ä¸€æ­¥

é…ç½® è‡ªå®šä¹‰åŸŸåï¼ˆFirebase Hosting / Cloud Runï¼‰

ä½¿ç”¨ Firebase Auth å¤„ç†ç”¨æˆ·ç™»å½•

åŠ å…¥ CI/CDï¼ˆCloud Build + GitHub Actionsï¼‰

è¿™æ ·ä¸€ä»½æ–‡æ¡£ï¼Œä½ æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½• README.md å°±è¡Œï¼ŒVSCode é‡Œçš„ AI æ’ä»¶ä¸€è¯»å°±èƒ½å¿«é€Ÿç†è§£æ•´ä¸ªæµç¨‹ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ æŠŠè¿™ä¸ªæ–‡æ¡£å†é…ä¸Š å®Œæ•´ç›®å½•ç»“æ„ï¼ˆå« Dockerfileã€é…ç½®æ–‡ä»¶ï¼‰ï¼Œç”Ÿæˆä¸€ä¸ªæœ€å°ä»“åº“æ¨¡æ¿ï¼Ÿ